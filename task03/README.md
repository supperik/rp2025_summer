# Задание №3

Добавьте в проект ModelLib указанную в варианте модель, следуя принципам объектно-ориентированного программирования:

1. Абстракция — интерфейс не раскрывает детали реализации, если они не важны для остального кода программы
2. Инкапсуляция — защита внутреннего состояния класса от прямого изменения
3. Соблюдаются инварианты — то есть внутреннее состояние созданного объекта должно всегда быть корректным
    - при попытке создать объект с некорректным состоянием бросается исключение
    - при попытке привести объект в некорректное состояние бросается исключение

> Инвариант — это требование к внутреннему состоянию объекта, которое выполняется как после конструирования, так и после любых изменений объекта.

Следует покрыть каждый добавляемый класс модульными тестами на XUnit, которые проверяют:

1. Все методы и свойства — минимум по одному разу
2. Все инварианты класса — минимум по одному разу
3. Все пограничные случаи, которые вы сможете выявить

# Варианты задания №3

> Вариант назначается преподавателем индивидуально.

# 1. Телефонные звонки

Спроектируйте и реализуйте класс `PhoneNumber`, представляющий телефонный номер в международном формате:

- Допускаются номера с символом `+` в начале и без него, например:
    - `+7 (8362) 45-02-72` → номер `+78362450272`
    - `7 (8362) 45-02-72` → номер `+78362450272`
    - `8 (8362) 45-02-72` → номер `+88362450272`
- Допускаются номера с добавочным (внутренним) номером после `x`, например:
    - `1-234-567-8901 x1234` → номер `+12345678901`, добавочный `1234`

В классе `PhoneNumber` должны быть:

- Конструктор `PhoneNumber(string text)`, создающий номер телефона из текстового представления
    - удаляет символы ` `, `-`, `(`, `)` (пробелы, дефисы, круглые скобки)
    - проверяет оставшиеся символы на соответствие формату
    - сохраняет отдельно основной номер и добавочный номер
- Свойство `Number`, возвращающее строку номера телефона с символом `+` в начале, но без добавочного номера
- Свойство `Ext`, возвращающее добавочный номер либо пустую строку
- Метод `ToString()`, возвращающий строку номера телефона с символом `+` в начале
    - Пример: `+78362450272` — когда нет добавочного номера
    - Пример: `+12345678901x1234` — когда есть добавочный номер

На основе класса `PhoneNumber` спроектируйте и реализуйте модель `PhoneCall`, которая имеет следующие свойства:

1. `PhoneCallStatus Status` — статус звонка
2. `DateTime Start` — время начала звонка
3. `TimeInterval DialUpDuration` — время дозвона (то есть время «гудков» от начала до приёма вызова)
4. `TimeInterval TalkDuration` — время разговора (то есть от приёма вызова до окончания звонка)
5. `TimeInterval TotalDuration` — общее время звонка
6. `DateTime End` — время окончания звонка
7. `PhoneNumber Caller` — номер телефона вызывающего абонента
8. `PhoneNumber Callee` — номер телефона вызываемого абонента

Конструктор класса `PhoneCall` должен быть приватным, а для создания используются статические методы:

- `static PhoneCall CreateFailed(DateTime start, PhoneNumber caller, PhoneNumber callee)` создаёт звонок со статусом `Failed`
- `static PhoneCall CreateMissed(DateTime start, DateTime end, PhoneNumber caller, PhoneNumber callee)` создаёт звонок со статусом `Missed`
- `static PhoneCall CreateDeclined(DateTime start, DateTime end, PhoneNumber caller, PhoneNumber callee)` создаёт звонок со статусом `Declined`
- `static PhoneCall CreateAccepted(DateTime start, DateTime acceptedAt, DateTime end, PhoneNumber caller, PhoneNumber callee)` создаёт звонок со статусом `Accepted`

Все способы создания класса должны поддерживать инварианты:

- абонент не может звонить самому себе
- время окончания не может быть меньше, чем время начала: `End >= Start`
- все длительности неотрицательные: `TotalDuration > 0`, `DialUpDuration > 0`, `TalkDuration > 0`
- выполняется равенство `TotalDuration = End - Start`
- выполняется равенство `TotalDuration = DialUpDuration + TalkDuration`
- некоторые статусы звонка вносят дополнительные ограничения

Если параметры для создания звонка нарушают инварианты, следует бросать исключение `ArgumentException`.

Статусы звонка:

| Статус   | Описание          | Ограничения                                           |
|----------|-------------------|-------------------------------------------------------|
| Failed   | Неудачный вызов   | Длительности дозвона и разговора должны быть нулевыми |
| Missed   | Пропущенный вызов | Длительность разговора должна быть нулевой            |
| Declined | Отклонённый вызов | Длительность разговора должна быть нулевой            |
| Accepted | Принятый вызов    | Длительность разговора не может быть нулевой          |

## 2. Контакты

Спроектируйте и реализуйте класс `PhoneNumber`, представляющий телефонный номер в международном формате:

- Допускаются номера с символом `+` в начале и без него, например:
    - `+7 (8362) 45-02-72` → номер `+78362450272`
    - `7 (8362) 45-02-72` → номер `+78362450272`
    - `8 (8362) 45-02-72` → номер `+88362450272`
- Допускаются номера с добавочным (внутренним) номером после `x`, например:
    - `1-234-567-8901 x1234` → номер `+12345678901`, добавочный `1234`

В классе `PhoneNumber` должны быть:

- Конструктор `PhoneNumber(string text)`, создающий номер телефона из текстового представления
    - удаляет символы ` `, `-`, `(`, `)` (пробелы, дефисы, круглые скобки)
    - проверяет оставшиеся символы на соответствие формату
    - сохраняет отдельно основной номер и добавочный номер
- Свойство `string Number`, возвращающее строку номера телефона с символом `+` в начале, но без добавочного номера
- Свойство `string Ext`, возвращающее добавочный номер либо пустую строку
- Метод `ToString()`, возвращающий строку номера телефона с символом `+` в начале
    - Пример: `+78362450272` — когда нет добавочного номера
    - Пример: `+12345678901x1234` — когда есть добавочный номер

На основе класса `PhoneNumber` спроектируйте и реализуйте модель `Contact`:

1. Контакт имеет свойства `string FirstName`, `string MiddleName` и `string LastName`, в которых указаны соответственно имя, отчество и фамилия контакта
    - свойство `FirstName` не может быть пустой строкой
2. Контакт может иметь 0, 1 или несколько номеров телефона
    - один из номеров всегда помечен как основной (primary), кроме случая, когда нет ни одного номера
    - свойство `List<PhoneNumber> PhoneNumbers` возвращает все номера телефонов
    - свойство `PhoneNumber? PrimaryPhoneNumber` возвращает основной номер телефона
    - метод `AddPhoneNumber(PhoneNumber value)` добавляет номер телефона либо ничего не делает, если номер уже был
    - метод `RemovePhoneNumber(PhoneNumber value)` удаляет номер телефона
    - метод `SetPrimaryPhoneNumber(PhoneNumber value)` меняет основной номер телефона

## 3. Бронирование переговорных комнат

Реализуйте классы моделей для бронирования переговорных комнат, в которой есть модели `DateTimeInterval`, `MeetingSchedule`, `MeetingRoom`.

Модель `DateTimeInterval` содержит:

- конструктор `DateTimeInterval(DateTime start, DateTimeInterval end)`
- свойство `DateTime Start`, возвращающее дату и время начала интервала
- свойство `DateTime End`, возвращающее дату и время окончания интервала
- свойство `TimeSpan Duration`, возвращающее длительность интервала
- метод bool `bool Overlaps(DateTimeInterval other)`, проверяющий пересечение двух интервалов
    - если интервалы примыкают вплотную друг к другу, это не считается пересечением

Дополнительные требования к модели `DateTimeInterval`

- реализует интерфейс `IComparable<DateTimeInterval>`, что позволяет сортировать список временных интервалов по дате начала интервала.
- поддерживает инвариант `End > Start`

Модель `MeetingSchedule` содержит:

- конструктор `MeetingSchedule()`, создающий пустое расписание
- метод `bool IsBusy(DateTimeInterval interval)`, проверяющий занятость переговорной комнаты в указанном интервале
    - метод возвращает `true`, если указанный интервал не пересекается с ранее добавленными
- метод `void Add(string meetingId, DateTimeInterval interval)`, добавляющий встречу в указанном интервале
    - метод ничего не делает, если встреча с таким ID уже была добавлена ранее
    - метод бросает `InvalidOperationException`, если встреча пересекается с ранее добавленными
    - метод бросает `InvalidOperationException`, если встреча уже завершилась

Модель `MeetingRoom` содержит:

- конструктор `MeetingRoom(string name)`, создающий комнату
- поле `MeetingSchedule _schedule`, которое хранит расписание комнаты
- свойство `string Name`, возвращающее название комнаты
- метод `bool IsBusy(DateTimeInterval interval)`, проверяющий занятость переговорной комнаты в указанном интервале
    - метод возвращает `true`, если указанный интервал не пересекается с ранее добавленными
- метод `void Add(string meetingId, DateTimeInterval interval)`, добавляющий встречу в указанном интервале
    - метод делегирует добавление классу `MeetingSchedule`
